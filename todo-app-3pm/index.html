<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
    <title>Todo App</title>
  </head>
  <body>
    <div class="container mt-2">
      <h1 class="text-center">Todo App</h1>

      <div class="row">
        <div
          id="alert-message"
          class="alert alert-danger"
          role="alert"
          style="display: none"
        >
          You cannot submit empty value
        </div>
        <div class="col-10">
          <input
            type="text"
            id="todo-input-form"
            class="form-control"
            placeholder="You New Todo"
          />
        </div>
        <div class="col-2">
          <button id="add-todo" type="button" class="btn btn-success w-100">
            Save
          </button>
        </div>
        <div class="col">
          <input
            type="search"
            id="search-input-form"
            class="form-control mt-2"
            placeholder="Search Todo"
          />
        </div>
      </div>
      <ul class="list-group mt-2" id="todo-container"></ul>
    </div>
    <script>
      const todoInputForm = document.getElementById("todo-input-form");
      const todos = ["Learn php", "learn html", "learn css"];

      const deleteTodoByIndex = (index) => {
        todos.splice(index, 1);
      };

      const addTodo = (newTodo) => {
        todos.push(newTodo);
      };

      const updateTodo = (index, updatedTodo) => {
        todos[index] = updatedTodo;
      };

      const readTodo = () => {
        let todoList = "";
        for (let i = 0; i < todos.length; i++) {
          todoList += `  
        <li class="list-group-item d-flex justify-content-between align-items-center" data-index="${i}">
          ${todos[i]}
          <span class="badge bg-info me-auto ms-1">In Progress</span>
          <button type="button" class="btn btn-primary me-1">Mark As Completed</button>
          <button type="button" data-action='edit' data-index='${i}' class="btn btn-secondary me-1">Edit</button>
          <button type="button" data-action='delete' data-index='${i}' class="btn btn-danger">Delete</button>
        </li>`;
        }
        document.getElementById("todo-container").innerHTML = todoList;
      };

      readTodo();

      document.getElementById("add-todo").addEventListener("click", (e) => {
        if (todoInputForm.dataset.index) {
          updateTodo(todoInputForm.dataset.index, todoInputForm.value);
          todoInputForm.dataset.index = null;
        } else {
          const newTodo = todoInputForm.value;
          addTodo(newTodo);
        }
        todoInputForm.value = null;
        readTodo();
      });

      document
        .getElementById("todo-container")
        .addEventListener("click", (e) => {
          // actoin = edit, delte, index= ??
          const action = e.target.dataset.action;
          const index = e.target.dataset.index;
          if (action === "delete") {
            deleteTodoByIndex(index);
            readTodo();
          } else if (action === "edit") {
            todoInputForm.dataset.index = index;
            todoInputForm.value = todos[index];
          }
        });
    </script>
  </body>
</html>
